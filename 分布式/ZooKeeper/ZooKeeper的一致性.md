# ZooKeeper 的一致性

![img](../../image/16385a1ee4301aa0)

`Zookeeper Service`集群是一主多从结构。

一个`Leader`对应多个`Follower` 和 `Observer`

为了保证主从节点的数据一致性，Zookeeper采用了**ZAB协议**，这种协议非常类似于一致性算法**Paxos**和**Raft**。

Zab协议既不是强一致性，也不是弱一致性，而是处于两者之间的**单调一致性**。它依靠事务ID和版本号，保证了数据的更新和读取是有序的。

## 什么是 ZAB 协议

为了保证写操作的一致性与可用性，`ZooKeeper`专门设计了一种名为 **原子广播（ZAB）**的支持崩溃恢复的一致性协议。基于该协议，`ZooKeeper`实现了一种主从模式的系统架构来保持集群中各个副本之间的数据一致性。

根据ZAB协议：

- **所有的写操作都必须通过Leader完成**，**Leader写入本地日志后再复制到所有的Follower节点**。
- 一旦Leader节点无法工作，**ZAB协议能够自动从Follower节点中重新选出一个合适的替代者**，即新的Leader，该过程即为领导选举。该领导选举过程，是ZAB协议中最为重要和复杂的过程。



